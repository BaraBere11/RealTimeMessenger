(this["webpackJsonp@whatsapp-clone/client"]=this["webpackJsonp@whatsapp-clone/client"]||[]).push([[0],{277:function(e,t,s){"use strict";s.r(t);var n=s(35),c=s(43),r=s(0),o=s.n(r),a=s(50),i=s.n(a),l=s(96),j=s(6),d=s(4);const{createContext:b,useState:u,useEffect:O}=s(0),m=b();var h=e=>{let{children:t}=e;const[s,n]=u({loggedIn:null,token:localStorage.getItem("token")}),c=Object(j.useNavigate)();return O((()=>{fetch("".concat(Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_SERVER_URL,"/auth/login"),{credentials:"include",headers:{authorization:"Bearer ".concat(s.token)}}).catch((e=>{n({loggedIn:!1})})).then((e=>{if(e&&e.ok&&!(e.status>=400))return e.json();n({loggedIn:!1})})).then((e=>{e?(n({...e}),c("/home")):n({loggedIn:!1})}))}),[]),Object(d.jsx)(m.Provider,{value:{user:s,setUser:n},children:t})},x=s(44),g=s(51);var p=()=>{const{colorMode:e,toggleColorMode:t}=Object(n.c)();return Object(d.jsx)(x.a,{onClick:()=>t(),pos:"absolute",top:"0",right:"0",m:"1rem",children:"dark"===e?Object(d.jsx)(g.d,{color:"orange.200"}):Object(d.jsx)(g.c,{color:"blue.700"})})},f=s(11),S=s(30),C=s(132);var v=e=>new C.a(Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_SERVER_URL,{autoConnect:!1,withCredentials:!0,auth:{token:e.token}}),_=s(55),E=s(16),R=s(84);var T=e=>{let{userid:t}=e;const{setMessages:s}=Object(r.useContext)(D),{socket:n}=Object(r.useContext)(H);return Object(d.jsx)(E.c,{initialValues:{message:""},validationSchema:R.object({message:R.string().min(1).max(255)}),onSubmit:(e,c)=>{const r={to:t,from:null,content:e.message};n.emit("dm",r),s((e=>[r,...e])),c.resetForm()},children:Object(d.jsxs)(f.e,{as:E.b,w:"100%",pb:"1.4rem",px:"1.4rem",children:[Object(d.jsx)(_.a,{as:E.a,name:"message",placeholder:"Type message here..",size:"lg",autoComplete:"off"}),Object(d.jsx)(x.a,{type:"submit",size:"lg",colorScheme:"teal",children:"Send"})]})})};var y=e=>{let{userid:t}=e;const{friendList:s}=Object(r.useContext)(L),{messages:n}=Object(r.useContext)(D),c=Object(r.useRef)(null);return Object(r.useEffect)((()=>{var e;null===(e=c.current)||void 0===e||e.scrollIntoView()})),s.length>0?Object(d.jsxs)(f.h,{h:"100%",justify:"end",children:[Object(d.jsx)(S.d,{overflowY:"scroll",children:s.map((e=>Object(d.jsxs)(f.h,{flexDir:"column-reverse",as:S.c,w:"100%",children:[Object(d.jsx)("div",{ref:c}),n.filter((t=>t.to===e.userid||t.from===e.userid)).map(((t,s)=>Object(d.jsx)(f.g,{m:t.to===e.userid?"1rem 0 0 auto !important":"1rem auto 0 0 !important",maxW:"50%",fontSize:"lg",bg:t.to===e.userid?"blue.100":"gray.100",color:"gray.800",borderRadius:"10px",p:"0.5rem 1rem",children:t.content},"msg:".concat(e.username,".").concat(s))))]},"chat:".concat(e.username))))}),Object(d.jsx)(T,{userid:t})]}):Object(d.jsx)(f.h,{justify:"center",pt:"5rem",w:"100%",textAlign:"center",fontSize:"lg",children:Object(d.jsx)(S.d,{children:Object(d.jsx)(S.c,{children:Object(d.jsx)(f.g,{children:"No friend :( Click add friend to start chatting"})})})})},w=s(14),P=s(40),k=s(58),I=s(46);var U=e=>{let{label:t,...s}=e;const[n,c]=Object(E.d)(s);return Object(d.jsxs)(I.a,{isInvalid:c.touched&&c.error,children:[Object(d.jsx)(I.c,{children:t}),Object(d.jsx)(_.a,{as:E.a,...n,...s}),Object(d.jsx)(I.b,{children:c.error})]})};var F=e=>{let{isOpen:t,onClose:s}=e;const[n,c]=Object(r.useState)(""),o=Object(r.useCallback)((()=>{c(""),s()}),[s]),{setFriendList:a}=Object(r.useContext)(L),{socket:i}=Object(r.useContext)(H);return Object(d.jsxs)(P.a,{isOpen:t,onClose:o,children:[Object(d.jsx)(P.g,{}),Object(d.jsxs)(P.d,{children:[Object(d.jsx)(P.f,{children:"Add a friend!"}),Object(d.jsx)(P.c,{}),Object(d.jsx)(E.c,{initialValues:{friendName:""},onSubmit:e=>{i.emit("add_friend",e.friendName,(e=>{let{errorMsg:t,done:s,newFriend:n}=e;if(s)return a((e=>[n,...e])),void o();c(t)}))},validationSchema:k.friendSchema,children:Object(d.jsxs)(E.b,{children:[Object(d.jsxs)(P.b,{children:[Object(d.jsx)(f.f,{fontSize:"xl",color:"red.500",textAlign:"center",children:n}),Object(d.jsx)(U,{label:"Friend's name",placeholder:"Enter friend's username..",autoComplete:"off",name:"friendName"})]}),Object(d.jsx)(P.e,{children:Object(d.jsx)(x.a,{colorScheme:"blue",type:"submit",children:"Submit"})})]})})]})]})};var A=()=>{const{friendList:e}=Object(r.useContext)(L),{isOpen:t,onOpen:s,onClose:n}=Object(w.d)();return Object(d.jsxs)(d.Fragment,{children:[Object(d.jsxs)(f.h,{py:"1.4rem",children:[Object(d.jsxs)(f.e,{justify:"space-evenly",w:"100%",children:[Object(d.jsx)(f.f,{size:"md",children:"Add Friend"}),Object(d.jsx)(x.a,{onClick:s,children:Object(d.jsx)(g.b,{})})]}),Object(d.jsx)(f.b,{}),Object(d.jsx)(f.h,{as:S.b,children:e.map((e=>Object(d.jsxs)(f.e,{as:S.a,children:[Object(d.jsx)(f.a,{bg:""+e.connected==="true"?"green.700":"red.500",w:"20px",h:"20px"}),Object(d.jsx)(f.g,{children:e.username})]},"friend:".concat(e))))})]}),Object(d.jsx)(F,{isOpen:t,onClose:n})]})};var N=(e,t,s)=>{const{setUser:n}=Object(r.useContext)(m);Object(r.useEffect)((()=>(s.connect(),s.on("friends",(t=>{e(t)})),s.on("messages",(e=>{t(e)})),s.on("dm",(e=>{t((t=>[e,...t]))})),s.on("connected",((t,s)=>{e((e=>[...e].map((e=>(e.username===s&&(e.connected=t),e)))))})),s.on("connect_error",(()=>{n({loggedIn:!1})})),()=>{s.off("connect_error"),s.off("connected"),s.off("friends"),s.off("messages"),s.off("dm")})),[n,e,t,s])};const L=Object(r.createContext)(),D=Object(r.createContext)(),H=Object(r.createContext)();var M=()=>{var e;const[t,s]=Object(r.useState)([]),[n,c]=Object(r.useState)([]),[o,a]=Object(r.useState)(0),{user:i}=Object(r.useContext)(m),[l,j]=Object(r.useState)((()=>v(i)));return Object(r.useEffect)((()=>{j((()=>v(i)))}),[i]),N(s,c,l),Object(d.jsx)(L.Provider,{value:{friendList:t,setFriendList:s},children:Object(d.jsx)(H.Provider,{value:{socket:l},children:Object(d.jsxs)(f.c,{templateColumns:"repeat(10, 1fr)",h:"100vh",as:S.e,onChange:e=>a(e),children:[Object(d.jsx)(f.d,{colSpan:"3",borderRight:"1px solid gray",children:Object(d.jsx)(A,{})}),Object(d.jsx)(f.d,{colSpan:"7",maxH:"100vh",children:Object(d.jsx)(D.Provider,{value:{messages:n,setMessages:c},children:Object(d.jsx)(y,{userid:null===(e=t[o])||void 0===e?void 0:e.userid})})})]})})})};var W=()=>{const{setUser:e}=Object(r.useContext)(m),[t,s]=Object(r.useState)(null),n=Object(j.useNavigate)();return Object(d.jsx)(E.c,{initialValues:{username:"",password:""},validationSchema:k.formSchema,onSubmit:(t,c)=>{const r={...t};c.resetForm(),fetch("".concat(Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_SERVER_URL,"/auth/login"),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).catch((e=>{})).then((e=>{if(e&&e.ok&&!(e.status>=400))return e.json()})).then((t=>{t&&(e({...t}),t.status?s(t.status):t.loggedIn&&(localStorage.setItem("token",t.token),n("/home")))}))},children:Object(d.jsxs)(f.h,{as:E.b,w:{base:"90%",md:"500px"},m:"auto",justify:"center",h:"100vh",spacing:"1rem",children:[Object(d.jsx)(f.f,{children:"Log In"}),Object(d.jsx)(f.g,{as:"p",color:"red.500",children:t}),Object(d.jsx)(U,{name:"username",placeholder:"Enter username",autoComplete:"off",label:"Username"}),Object(d.jsx)(U,{name:"password",placeholder:"Enter password",autoComplete:"off",label:"Password",type:"password"}),Object(d.jsxs)(x.b,{pt:"1rem",children:[Object(d.jsx)(x.a,{colorScheme:"teal",type:"submit",children:"Log In"}),Object(d.jsx)(x.a,{onClick:()=>n("/register"),children:"Create Account"})]})]})})};var K=()=>{const{setUser:e}=Object(r.useContext)(m),[t,s]=Object(r.useState)(null),n=Object(j.useNavigate)();return Object(d.jsx)(E.c,{initialValues:{username:"",password:""},validationSchema:k.formSchema,onSubmit:(t,c)=>{const r={...t};c.resetForm(),fetch("".concat(Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_SERVER_URL,"/auth/signup"),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).catch((e=>{})).then((e=>{if(e&&e.ok&&!(e.status>=400))return e.json()})).then((t=>{t&&(e({...t}),t.status?s(t.status):t.loggedIn&&(localStorage.setItem("token",t.token),n("/home")))}))},children:Object(d.jsxs)(f.h,{as:E.b,w:{base:"90%",md:"500px"},m:"auto",justify:"center",h:"100vh",spacing:"1rem",children:[Object(d.jsx)(f.f,{children:"Sign Up"}),Object(d.jsx)(f.g,{as:"p",color:"red.500",children:t}),Object(d.jsx)(U,{name:"username",placeholder:"Enter username",autoComplete:"off",label:"Username"}),Object(d.jsx)(U,{name:"password",placeholder:"Enter password",autoComplete:"off",label:"Password",type:"password"}),Object(d.jsxs)(x.b,{pt:"1rem",children:[Object(d.jsx)(x.a,{colorScheme:"teal",type:"submit",children:"Create Account"}),Object(d.jsx)(x.a,{onClick:()=>n("/"),leftIcon:Object(d.jsx)(g.a,{}),children:"Back"})]})]})})};const{Outlet:V,Navigate:z}=s(6);var B=()=>(()=>{const{user:e}=Object(r.useContext)(m);return e&&e.loggedIn})()?Object(d.jsx)(V,{}):Object(d.jsx)(z,{to:"/"});var q=()=>{const{user:e}=Object(r.useContext)(m);return null===e.loggedIn?Object(d.jsx)(f.g,{children:"Loading..."}):Object(d.jsxs)(j.Routes,{children:[Object(d.jsx)(j.Route,{path:"/",element:Object(d.jsx)(W,{})}),Object(d.jsx)(j.Route,{path:"/register",element:Object(d.jsx)(K,{})}),Object(d.jsx)(j.Route,{element:Object(d.jsx)(B,{}),children:Object(d.jsx)(j.Route,{path:"/home",element:Object(d.jsx)(M,{})})}),Object(d.jsx)(j.Route,{path:"*",element:Object(d.jsx)(W,{})})]})};var J=function(){return Object(d.jsxs)(h,{children:[Object(d.jsx)(q,{}),Object(d.jsx)(p,{})]})};var Y=Object(c.b)({config:{intialColorMode:"dark",useSystemColorMode:!0},styles:{global:{body:{margin:0,fontFamily:"-apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen','Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',sans-serif",WebKitFontSmoothing:"antialiased",MozOsxFontSmoothing:"grayscale"},code:{fontFamily:"source-code-pro, Menlo, Monaco, Consolas, 'Courier New',monospace"}}}});i.a.render(Object(d.jsx)(o.a.StrictMode,{children:Object(d.jsx)(l.a,{children:Object(d.jsxs)(c.a,{theme:Y,children:[Object(d.jsx)(n.b,{initialColorMode:Y.config.initialColorMode}),Object(d.jsx)(J,{})]})})}),document.getElementById("root"))},58:function(e,t,s){const n=s(84),c=n.object({username:n.string().required("Username required").min(6,"Username too short").max(28,"Username too long!"),password:n.string().required("Password required").min(6,"Password too short").max(28,"Password too long!")}),r=n.object({friendName:n.string().required("Username required").min(6,"Invalid username!").max(28,"Invalid username!")});e.exports={formSchema:c,friendSchema:r}}},[[277,1,2]]]);
//# sourceMappingURL=main.34e01d58.chunk.js.map